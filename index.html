<script type="module">
import * as THREE from 'three';
import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';

const scene = new THREE.Scene();
scene.background = new THREE.Color(0x222222);

/* é¡é ­ */
const camera = new THREE.PerspectiveCamera(45, innerWidth/innerHeight, 0.1, 100);
camera.position.set(0, 1.5, 5);
camera.lookAt(0, 1, 0);

/* Renderer */
const renderer = new THREE.WebGLRenderer({ antialias:true });
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(devicePixelRatio);
document.body.appendChild(renderer.domElement);

/* è¶…äº®å…‰ï¼ˆé¿å…å…¨é»‘ï¼‰ */
scene.add(new THREE.AmbientLight(0xffffff, 1.2));
const light = new THREE.DirectionalLight(0xffffff, 2);
light.position.set(5,10,5);
scene.add(light);

/* å¤–å±¤ç¾¤çµ„ */
const clockGroup = new THREE.Group();
scene.add(clockGroup);

let hourHand, minuteHand, secondHand;

new GLTFLoader().load('./2026-01-05.glb', gltf => {

    const model = gltf.scene;

    /* ðŸ”¥ é—œéµï¼šå¼·åˆ¶æ”¾åˆ°é¡é ­å‰ */
    model.position.set(0, 0, 0);
    model.scale.set(1, 1, 1);

    clockGroup.add(model);

    /* çœ‹çœ‹å¯¦éš›ç¯€é»žåç¨± */
    model.traverse(o => console.log(o.name));

    hourHand   = model.getObjectByName('HourHand');
    minuteHand = model.getObjectByName('MinuteHand');
    secondHand = model.getObjectByName('SecondHand');

}, undefined, e => {
    console.error(e);
});

/* æ™‚é˜æ›´æ–° */
function updateClock(){
    if(!secondHand) return;

    const now = new Date();
    const s = now.getSeconds() + now.getMilliseconds()/1000;
    const m = now.getMinutes() + s/60;
    const h = (now.getHours()%12) + m/60;

    secondHand.rotation.z = -s/60 * Math.PI*2;
    minuteHand.rotation.z = -m/60 * Math.PI*2;
    hourHand.rotation.z   = -h/12 * Math.PI*2;
}

/* æ•´é¡†å·¦å³æ“º */
let t = 0;
function animate(){
    requestAnimationFrame(animate);
    t += 0.01;

    updateClock();

    /* å°è§’åº¦ï¼Œé¿å…è½‰å‡ºé¡é ­ */
    clockGroup.rotation.y = Math.sin(t) * 0.5;

    renderer.render(scene, camera);
}
animate();

addEventListener('resize', ()=>{
    camera.aspect = innerWidth/innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(innerWidth, innerHeight);
});
</script>
