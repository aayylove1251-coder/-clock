<script type="module">
import * as THREE from 'three';
import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';

const scene = new THREE.Scene();

/* 固定鏡頭（正面觀看） */
const camera = new THREE.PerspectiveCamera(45, innerWidth/innerHeight, 0.1, 100);
camera.position.set(0, 2.2, 6);
camera.lookAt(0, 1, 0);

const renderer = new THREE.WebGLRenderer({ antialias:true });
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(devicePixelRatio);
document.body.appendChild(renderer.domElement);

/* 光源 */
scene.add(new THREE.AmbientLight(0xffffff, 0.8));
const light = new THREE.DirectionalLight(0xffffff, 1);
light.position.set(5,10,5);
scene.add(light);

/* ===== 關鍵：外層群組 ===== */
const clockGroup = new THREE.Group();
scene.add(clockGroup);

let hourHand, minuteHand, secondHand;

new GLTFLoader().load('./2026-01-05.glb', gltf => {

    const model = gltf.scene;

    /* ✔ 修正正面方向（90% 的 Blender 模型適用） */
    model.rotation.x = -Math.PI / 2;

    clockGroup.add(model);

    hourHand   = model.getObjectByName('HourHand');
    minuteHand = model.getObjectByName('MinuteHand');
    secondHand = model.getObjectByName('SecondHand');
});

/* ===== 時鐘同步 ===== */
function updateClock(){
    if(!hourHand) return;

    const now = new Date();
    const s = now.getSeconds() + now.getMilliseconds()/1000;
    const m = now.getMinutes() + s/60;
    const h = (now.getHours()%12) + m/60;

    /* 指針只轉 Z 軸 */
    secondHand.rotation.z = -s/60 * Math.PI*2;
    minuteHand.rotation.z = -m/60 * Math.PI*2;
    hourHand.rotation.z   = -h/12 * Math.PI*2;
}

/* ===== 整顆時鐘 ±45° 擺動 ===== */
let t = 0;
function animate(){
    requestAnimationFrame(animate);
    t += 0.01;

    updateClock();

    /* 整體左右擺動（正面） */
    clockGroup.rotation.y = Math.sin(t) * THREE.MathUtils.degToRad(45);

    renderer.render(scene, camera);
}
animate();

/* resize */
addEventListener('resize', ()=>{
    camera.aspect = innerWidth/innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(innerWidth, innerHeight);
});
</script>
